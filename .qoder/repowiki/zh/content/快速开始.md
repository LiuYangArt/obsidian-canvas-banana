# å¿«é€Ÿå¼€å§‹

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [README.md](file://README.md)
- [main.ts](file://main.ts)
- [api-manager.ts](file://api-manager.ts)
- [intent-resolver.ts](file://intent-resolver.ts)
- [canvas-converter.ts](file://canvas-converter.ts)
- [types.ts](file://types.ts)
- [manifest.json](file://manifest.json)
- [package.json](file://package.json)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–åˆ†æ](#ä¾èµ–åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹
æœ¬æŒ‡å—é¢å‘ Obsidian æ–°æ‰‹ï¼Œå¸®åŠ©ä½ åœ¨ 5 åˆ†é’Ÿå†…å®Œæˆæ’ä»¶å®‰è£…ã€é…ç½® API Keyï¼Œå¹¶æˆåŠŸè¿è¡Œç¬¬ä¸€ä¸ª AI ä»»åŠ¡ï¼ˆåœ¨ Canvas ä¸­é€‰ä¸­èŠ‚ç‚¹ã€å”¤èµ·æ‚¬æµ®é¢æ¿ã€åœ¨ Text æ¨¡å¼ç”Ÿæˆæ–‡æœ¬æ‘˜è¦ï¼Œåœ¨ Image æ¨¡å¼ç”Ÿæˆå›¾åƒï¼‰ã€‚æ–‡ä¸­æ‰€æœ‰æ­¥éª¤å‡åŸºäºä»“åº“æä¾›çš„ README ä¸æºç å®ç°ï¼Œé…åˆå›¾ç‰‡é“¾æ¥ä¾¿äºå¯¹ç…§æ“ä½œã€‚

## é¡¹ç›®ç»“æ„
è¯¥æ’ä»¶ä¸º Obsidian Canvas å¢å¼ºæ’ä»¶ï¼Œæ ¸å¿ƒå›´ç»• Canvas é€‰åŒºä¸Šä¸‹æ–‡æ„ŸçŸ¥ã€AI å¯¹è¯ä¸å›¾åƒç”Ÿæˆå±•å¼€ã€‚ä¸»è¦æ–‡ä»¶èŒè´£å¦‚ä¸‹ï¼š
- README.mdï¼šå®‰è£…ä¸ä½¿ç”¨è¯´æ˜ã€åŠŸèƒ½æ¦‚è§ˆä¸æˆªå›¾
- main.tsï¼šæ’ä»¶ä¸»é€»è¾‘ã€è®¾ç½®é¡¹ã€æµ®åŠ¨é¢æ¿ã€æç¤ºè¯é¢„è®¾ã€ä»»åŠ¡å¹¶å‘ä¸ç”Ÿæˆæµç¨‹
- api-manager.tsï¼šç»Ÿä¸€ç®¡ç† OpenRouter/Yunwu APIï¼Œå°è£…èŠå¤©ä¸å›¾åƒç”Ÿæˆè¯·æ±‚
- intent-resolver.tsï¼šæ„å›¾è§£æç®¡çº¿ï¼Œå°† Canvas é€‰åŒºè½¬æ¢ä¸º AI å¯ç†è§£çš„æŒ‡ä»¤ä¸ä¸Šä¸‹æ–‡
- canvas-converter.tsï¼šå°† Canvas èŠ‚ç‚¹è½¬æ¢ä¸º Markdown/Mermaid ç­‰ç»“æ„åŒ–å†…å®¹ï¼Œå¹¶è¯»å–å›¾ç‰‡ä¸ .md æ–‡ä»¶å†…å®¹
- types.tsï¼šCanvas API ç±»å‹å®šä¹‰ï¼Œæ‰©å±• Obsidian Canvas ç›¸å…³æ¥å£
- manifest.json/package.jsonï¼šæ’ä»¶å…ƒæ•°æ®ä¸æ„å»ºè„šæœ¬

```mermaid
graph TB
A["README.md<br/>å®‰è£…ä¸ä½¿ç”¨è¯´æ˜"] --> B["main.ts<br/>æ’ä»¶ä¸»é€»è¾‘/è®¾ç½®/é¢æ¿"]
B --> C["api-manager.ts<br/>API ç®¡ç†OpenRouter/Yunwu"]
B --> D["intent-resolver.ts<br/>æ„å›¾è§£ææŒ‡ä»¤/ä¸Šä¸‹æ–‡"]
D --> E["canvas-converter.ts<br/>èŠ‚ç‚¹è½¬æ¢/è¯»å–å›¾ç‰‡/.md"]
B --> F["types.ts<br/>Canvas ç±»å‹å®šä¹‰"]
G["manifest.json<br/>æ’ä»¶å…ƒæ•°æ®"] --> B
H["package.json<br/>æ„å»ºè„šæœ¬"] --> B
```

å›¾è¡¨æ¥æº
- [README.md](file://README.md#L41-L101)
- [main.ts](file://main.ts#L1-L120)
- [api-manager.ts](file://api-manager.ts#L1-L120)
- [intent-resolver.ts](file://intent-resolver.ts#L1-L60)
- [canvas-converter.ts](file://canvas-converter.ts#L1-L60)
- [types.ts](file://types.ts#L1-L40)
- [manifest.json](file://manifest.json#L1-L9)
- [package.json](file://package.json#L1-L20)

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L41-L101)
- [manifest.json](file://manifest.json#L1-L9)
- [package.json](file://package.json#L1-L20)

## æ ¸å¿ƒç»„ä»¶
- æ’ä»¶è®¾ç½®ä¸é¢æ¿
  - è®¾ç½®é¡¹åŒ…å« API æä¾›å•†ï¼ˆOpenRouter/Yunwuï¼‰ã€API Keyã€æ–‡æœ¬/å›¾åƒæ¨¡å‹ã€é»˜è®¤çºµæ¨ªæ¯”/åˆ†è¾¨ç‡ã€æ¸©åº¦ã€è°ƒè¯•æ¨¡å¼ã€å›¾åƒç³»ç»Ÿæç¤ºã€æç¤ºè¯é¢„è®¾ç­‰ã€‚
  - æµ®åŠ¨é¢æ¿æ”¯æŒ Text ä¸ Image ä¸¤ä¸ªæ ‡ç­¾é¡µï¼Œå†…ç½®é¢„è®¾ç®¡ç†ã€ä¸Šä¸‹æ–‡é¢„è§ˆã€ç”ŸæˆæŒ‰é’®ä¸é€‰é¡¹åˆ‡æ¢ã€‚
- API ç®¡ç†å™¨
  - ç»Ÿä¸€å¤„ç†èŠå¤©ä¸å›¾åƒç”Ÿæˆè¯·æ±‚ï¼Œå…¼å®¹ OpenRouter ä¸ Yunwu çš„ä¸åŒç«¯ç‚¹ä¸å‚æ•°é£æ ¼ã€‚
- æ„å›¾è§£æå™¨
  - å°† Canvas é€‰åŒºè½¬æ¢ä¸º AI æŒ‡ä»¤ä¸ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨åˆ†é…å›¾ç‰‡è¯­ä¹‰è§’è‰²ï¼Œæ„å»ºæ–‡æœ¬ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒé»˜è®¤å›é€€ç­–ç•¥ã€‚
- Canvas è½¬æ¢å™¨
  - è¯»å–å›¾ç‰‡ä¸ºå‹ç¼© WebP Base64ï¼Œè¯»å– .md æ–‡ä»¶å†…å®¹ï¼Œè¾“å‡º Markdown/Mermaidï¼Œæ”¯æŒç¾¤ç»„å±•å¼€ä¸è¾¹æå–ã€‚

ç« èŠ‚æ¥æº
- [main.ts](file://main.ts#L1-L120)
- [api-manager.ts](file://api-manager.ts#L1-L120)
- [intent-resolver.ts](file://intent-resolver.ts#L1-L120)
- [canvas-converter.ts](file://canvas-converter.ts#L1-L120)

## æ¶æ„æ€»è§ˆ
ä¸‹å›¾å±•ç¤ºä»ç”¨æˆ·åœ¨ Canvas ä¸­é€‰ä¸­èŠ‚ç‚¹åˆ°ç”Ÿæˆç»“æœçš„å…³é”®æµç¨‹ä¸æ¨¡å—äº¤äº’ã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·"
participant V as "Canvas è§†å›¾"
participant M as "main.ts<br/>FloatingPalette"
participant IR as "intent-resolver.ts"
participant CC as "canvas-converter.ts"
participant AM as "api-manager.ts"
participant API as "OpenRouter/Yunwu"
U->>V : é€‰ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹
V->>M : å¼¹å‡ºåŸç”Ÿèœå•å¹¶è§¦å‘é¦™è•‰å›¾æ ‡
M->>M : æ˜¾ç¤ºæ‚¬æµ®é¢æ¿Text/Image
U->>M : è¾“å…¥æŒ‡ä»¤/é€‰æ‹©é¢„è®¾/è°ƒæ•´é€‰é¡¹
M->>IR : resolve(app, canvas, selection, prompt, mode, settings)
IR->>CC : convert(app, canvas, selection, quality, size)
CC-->>IR : èŠ‚ç‚¹/è¾¹/å›¾ç‰‡Base64/.mdå†…å®¹
IR-->>M : instruction/context/images
M->>AM : chatCompletion()/generateImage()/multimodalChat()
AM->>API : å‘é€è¯·æ±‚å«æ¨¡å‹ã€æ¸©åº¦ã€çºµæ¨ªæ¯”ã€åˆ†è¾¨ç‡
API-->>AM : è¿”å›æ–‡æœ¬/å›¾åƒæ•°æ®
AM-->>M : è§£æå“åº”
M-->>V : åœ¨ Canvas ä¸­æ’å…¥æ–°èŠ‚ç‚¹æ–‡æœ¬/å›¾ç‰‡
```

å›¾è¡¨æ¥æº
- [main.ts](file://main.ts#L200-L320)
- [intent-resolver.ts](file://intent-resolver.ts#L60-L140)
- [canvas-converter.ts](file://canvas-converter.ts#L320-L420)
- [api-manager.ts](file://api-manager.ts#L140-L220)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### å®‰è£…ä¸å¯ç”¨ï¼ˆ5 åˆ†é’Ÿï¼‰
- æ‰‹åŠ¨å®‰è£…æ­¥éª¤
  1) è®¿é—® README ä¸­çš„ä¸‹è½½é“¾æ¥ï¼Œè·å–æ’ä»¶ ZIP åŒ…ã€‚
  2) æ‰“å¼€ä½ çš„ Obsidian ä»“åº“ç›®å½•ï¼Œè¿›å…¥ .obsidian/plugins/ï¼Œå°† ZIP è§£å‹åˆ°è¯¥ç›®å½•ã€‚
  3) é‡å¯ Obsidianï¼Œè¿›å…¥â€œè®¾ç½®â€->â€œç¬¬ä¸‰æ–¹æ’ä»¶â€ï¼Œå…³é—­â€œå®‰å…¨æ¨¡å¼â€ï¼Œæ‰¾åˆ°â€œCanvas Bananaâ€å¹¶å¯ç”¨ã€‚
- å‚è€ƒæˆªå›¾
  - æ’ä»¶ä¸‹è½½ä¸è§£å‹ä½ç½®è¯´æ˜
  - å¯ç”¨æ’ä»¶ç•Œé¢ç¤ºæ„

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L41-L63)

### é…ç½® API Keyï¼ˆé€‰æ‹© OpenRouter æˆ– Yunwuï¼‰
- æ‰“å¼€â€œè®¾ç½®â€->â€œCanvas Bananaâ€
- é€‰æ‹© API Providerï¼ˆé»˜è®¤ OpenRouterï¼‰
- å¡«å†™ API Keyï¼ˆOpenRouter æˆ– Yunwuï¼‰
- ï¼ˆå¯é€‰ï¼‰é€‰æ‹©æˆ–è‡ªå®šä¹‰ Text/Image æ¨¡å‹
- å‚è€ƒé“¾æ¥
  - è·å– API æ³¨å†Œåœ°å€ï¼ˆYunwuã€GPTGodï¼‰

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L64-L74)
- [main.ts](file://main.ts#L1-L120)
- [api-manager.ts](file://api-manager.ts#L85-L140)

### åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

#### åœ¨ Canvas ä¸­é€‰ä¸­èŠ‚ç‚¹å¹¶å”¤èµ·é¢æ¿
- æ‰“å¼€ä¸€ä¸ª Canvas æ–‡ä»¶ï¼Œä½¿ç”¨é¼ æ ‡æ¡†é€‰æˆ–ç‚¹å‡»é€‰ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹
- åœ¨èŠ‚ç‚¹ä¸Šæ–¹å‡ºç°çš„åŸç”Ÿèœå•ä¸­ï¼Œç‚¹å‡»â€œé¦™è•‰å›¾æ ‡â€
- æ‚¬æµ®é¢æ¿ä¼šå‡ºç°åœ¨é€‰ä¸­æ¡†å³ä¾§

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L75-L81)
- [main.ts](file://main.ts#L200-L320)

#### åœ¨ Text æ¨¡å¼ç”Ÿæˆæ–‡æœ¬æ‘˜è¦
- åˆ‡æ¢åˆ°â€œTextâ€æ ‡ç­¾é¡µ
- è¾“å…¥ä½ çš„æŒ‡ä»¤æˆ–é—®é¢˜ï¼›å¯é€‰åœ°é€‰æ‹©ä¸€ä¸ªé¢„è®¾å¿«é€Ÿå¡«å…¥ Prompt
- ç‚¹å‡»â€œGenerateâ€
- AI å›å¤å°†ä»¥æ–°å¡ç‰‡èŠ‚ç‚¹å½¢å¼æ’å…¥ Canvas

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L82-L87)
- [main.ts](file://main.ts#L320-L420)
- [api-manager.ts](file://api-manager.ts#L140-L220)

#### åœ¨ Image æ¨¡å¼ç”Ÿæˆå›¾åƒ
- åˆ‡æ¢åˆ°â€œImageâ€æ ‡ç­¾é¡µ
- åœ¨è¾“å…¥æ¡†æè¿°ç”»é¢ï¼ˆç•™ç©ºåˆ™é»˜è®¤ä½¿ç”¨é€‰ä¸­èŠ‚ç‚¹çš„æ–‡æœ¬ï¼‰
- è°ƒæ•´åˆ†è¾¨ç‡ï¼ˆ1K/2K/4Kï¼‰ä¸çºµæ¨ªæ¯”ï¼ˆ1:1ã€16:9ã€4:3ã€9:16 ç­‰ï¼‰
- ç‚¹å‡»â€œGenerateâ€
- ç”Ÿæˆçš„å›¾ç‰‡ä»¥å›¾ç‰‡èŠ‚ç‚¹æ’å…¥ Canvas

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L88-L94)
- [main.ts](file://main.ts#L320-L420)
- [api-manager.ts](file://api-manager.ts#L190-L275)

### æç¤ºè¯é¢„è®¾ç®¡ç†
- åœ¨é¢æ¿è¾“å…¥æ¡†ä¸Šæ–¹æœ‰ä¸€æ’å·¥å…·æŒ‰é’®ï¼š
  - â€œ+ (Add)â€ï¼šå°†å½“å‰è¾“å…¥ä¿å­˜ä¸ºæ–°é¢„è®¾
  - â€œğŸ’¾ (Save)â€ï¼šæ›´æ–°å½“å‰é€‰ä¸­çš„é¢„è®¾å†…å®¹
  - â€œâŒ (Delete)â€ï¼šåˆ é™¤å½“å‰é€‰ä¸­çš„é¢„è®¾
  - â€œğŸ“– (Rename)â€ï¼šé‡å‘½åå½“å‰é¢„è®¾

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L95-L101)
- [main.ts](file://main.ts#L420-L620)

## ä¾èµ–åˆ†æ
- æ¨¡å—è€¦åˆ
  - main.ts ä¾èµ– api-manager.tsã€intent-resolver.tsã€canvas-converter.tsã€types.ts
  - intent-resolver.ts ä¾èµ– canvas-converter.ts ä¸ types.ts
  - canvas-converter.ts ä¾èµ– types.ts ä¸ Obsidian vault API
  - api-manager.ts ä¾èµ– Obsidian requestUrl ä¸ main.ts çš„è®¾ç½®é¡¹
- å¤–éƒ¨ä¾èµ–
  - Obsidian Canvas APIï¼ˆtypes.ts æ‰©å±•ï¼‰
  - OpenRouter/Yunwu ç¬¬ä¸‰æ–¹ APIï¼ˆapi-manager.tsï¼‰
- æ½œåœ¨å¾ªç¯ä¾èµ–
  - å½“å‰æ–‡ä»¶ç»„ç»‡æ¸…æ™°ï¼Œæœªè§å¾ªç¯å¯¼å…¥

```mermaid
graph LR
MAIN["main.ts"] --> API["api-manager.ts"]
MAIN --> INT["intent-resolver.ts"]
INT --> CONV["canvas-converter.ts"]
MAIN --> TYPES["types.ts"]
CONV --> TYPES
API --> MAIN
```

å›¾è¡¨æ¥æº
- [main.ts](file://main.ts#L1-L120)
- [api-manager.ts](file://api-manager.ts#L1-L120)
- [intent-resolver.ts](file://intent-resolver.ts#L1-L60)
- [canvas-converter.ts](file://canvas-converter.ts#L1-L60)
- [types.ts](file://types.ts#L1-L40)

ç« èŠ‚æ¥æº
- [main.ts](file://main.ts#L1-L120)
- [api-manager.ts](file://api-manager.ts#L1-L120)
- [intent-resolver.ts](file://intent-resolver.ts#L1-L60)
- [canvas-converter.ts](file://canvas-converter.ts#L1-L60)
- [types.ts](file://types.ts#L1-L40)

## æ€§èƒ½è€ƒè™‘
- å¤šä»»åŠ¡å¹¶å‘
  - é¢æ¿æ”¯æŒâ€œå‘å°„åä¸ç®¡â€ï¼Œå¯åŒæ—¶å‘èµ·å¤šä¸ªç”Ÿæˆä»»åŠ¡ï¼Œæ— éœ€ç­‰å¾…ä¸Šä¸€ä¸ªå®Œæˆï¼Œæå‡æ•ˆç‡ã€‚
- å›¾ç‰‡å‹ç¼©ä¸å°ºå¯¸é™åˆ¶
  - Canvas è½¬æ¢å™¨å°†å›¾ç‰‡å‹ç¼©ä¸º WebPï¼Œå¹¶é™åˆ¶æœ€å¤§å°ºå¯¸ï¼Œå‡å°‘ä¼ è¾“ä½“ç§¯ä¸ API è´¹ç”¨ã€‚
- æ¸©åº¦ä¸æ¨¡å‹é€‰æ‹©
  - å¯é€šè¿‡è®¾ç½®è°ƒèŠ‚ Temperature æ§åˆ¶åˆ›é€ æ€§ï¼›æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ Text/Image æ¨¡å‹ã€‚

ç« èŠ‚æ¥æº
- [main.ts](file://main.ts#L320-L420)
- [canvas-converter.ts](file://canvas-converter.ts#L350-L420)
- [api-manager.ts](file://api-manager.ts#L140-L220)

## æ•…éšœæ’æŸ¥æŒ‡å—
- æ— æ³•ç”Ÿæˆå†…å®¹
  - ç¡®è®¤å·²åœ¨â€œè®¾ç½®â€->â€œCanvas Bananaâ€ä¸­é…ç½® API Provider ä¸ API Key
  - è‹¥ä¸ºç©ºç™½æç¤ºï¼Œæ’ä»¶ä¼šä½¿ç”¨é»˜è®¤å›é€€ç­–ç•¥ï¼ˆä¾‹å¦‚åœ¨ Image æ¨¡å¼ä¸‹ç”Ÿæˆå›¾åƒçš„é»˜è®¤æŒ‡ä»¤ï¼‰
- å›¾åƒç”Ÿæˆå¤±è´¥
  - æ£€æŸ¥çºµæ¨ªæ¯”ä¸åˆ†è¾¨ç‡è®¾ç½®æ˜¯å¦åˆç†
  - ç¡®è®¤æ‰€é€‰å›¾ç‰‡æ•°é‡æœªè¶…è¿‡ä¸Šé™
- API è¯·æ±‚é”™è¯¯
  - æŸ¥çœ‹ç½‘ç»œä¸ API Key æ˜¯å¦æ­£ç¡®
  - å¦‚é‡ HTTP é”™è¯¯ï¼Œå…³æ³¨è¿”å›ä½“ä¸­çš„é”™è¯¯ä¿¡æ¯

ç« èŠ‚æ¥æº
- [main.ts](file://main.ts#L760-L820)
- [api-manager.ts](file://api-manager.ts#L640-L679)
- [intent-resolver.ts](file://intent-resolver.ts#L100-L140)

## ç»“è®º
é€šè¿‡æœ¬å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼Œä½ å·²æŒæ¡ä»å®‰è£…ã€é…ç½®åˆ°è¿è¡Œç¬¬ä¸€ä¸ª AI ä»»åŠ¡çš„å®Œæ•´æµç¨‹ã€‚å»ºè®®åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ç»“åˆæç¤ºè¯é¢„è®¾ä¸ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›ï¼Œè¿›ä¸€æ­¥æå‡åˆ›ä½œæ•ˆç‡ä¸è´¨é‡ã€‚

## é™„å½•

### å¿«é€Ÿå¯¹ç…§æ¸…å•
- å®‰è£…
  - ä¸‹è½½ ZIP å¹¶è§£å‹åˆ° .obsidian/plugins/
  - é‡å¯ Obsidianï¼Œå¯ç”¨ Canvas Banana
- é…ç½®
  - è®¾ç½® -> Canvas Banana -> é€‰æ‹© OpenRouter/Yunwu -> å¡«å†™ API Key -> å¯é€‰è®¾ç½®æ¨¡å‹
- ä½¿ç”¨
  - Canvas é€‰ä¸­èŠ‚ç‚¹ -> ç‚¹å‡»é¦™è•‰å›¾æ ‡ -> Text æ¨¡å¼è¾“å…¥æŒ‡ä»¤/é¢„è®¾ -> Generate
  - Image æ¨¡å¼è¾“å…¥ç”»é¢æè¿°/ç•™ç©º -> è°ƒæ•´çºµæ¨ªæ¯”/åˆ†è¾¨ç‡ -> Generate

ç« èŠ‚æ¥æº
- [README.md](file://README.md#L41-L101)
- [main.ts](file://main.ts#L200-L420)